<h2> <%= Promo.human_attribute_name(:promo) %>: <%= @promo.name %> </h2>
<% if user_signed_in? %>
  <hr>
  <%= link_to 'Editar', edit_promo_path(@promo.id), class: "btn btn-primary  btn-m" %>
  <hr>
<% end %>
<dl>
  <dt><strong><%= Promo.human_attribute_name(:starting_date) %>: </strong><%= I18n.localize(@promo.starting_date) %></dt>
  <dt><strong><%= Promo.human_attribute_name(:ending_date) %>: </strong><%= I18n.localize(@promo.ending_date) %></dt>
  <dt><strong><%= Promo.human_attribute_name(:usages_max) %>: </strong><%= @promo.usages_max %></dt>
  <dt><strong><%= Promo.human_attribute_name(:voucher) %>: </strong><%= @promo.voucher %></dt>
  <dt><strong><%= Promo.human_attribute_name(:discount_percentage) %>: </strong><%= @promo.discount_percentage %> %</dt>
  <dt><strong><%= Promo.human_attribute_name(:discount_max) %>: </strong> <%= number_to_currency(@promo.currency, unit: "R$", separator: ",", delimiter: "") %></dt>
</dl>

<table>
  <% json_data = [
    {
      "id":1,
      "product_model":"TV 32",
      "launch_year":"2022",
      "brand":"LG",
      "price":"5000.0",
      "status":"active",
      "product_category_id":1,
      "created_at":"2022-11-08T19:42:47.921Z",
      "updated_at":"2022-11-08T19:42:47.921Z"
    },
    {
      "id":2,
      "product_model":"TV 50",
      "launch_year":"2021",
      "brand":"SAMSUNG",
      "price":"8000.0",
      "status":"active",
      "product_category_id":1,
      "created_at":"2022-11-08T19:43:08.381Z",
      "updated_at":"2022-11-08T19:43:08.381Z"
    }
  ]%>

<% begin %>
  <%= form_with model: [@promo, @promo_product] do |product| %>
    <%= product.label :product_id %>
    <%= product.select :product_id, ProductsApi.products_array  %>
    <%= product.submit 'Enviar', class: "btn btn-primary  btn-m"%>
  <% end %>
<table class="table table-striped table-bordered bg-gray">
  <thead>
    <tr>
      <th scope="col">Produtos inclusos nesta promoção</th>  
    </tr>
  </thead>
  <% if @promo.promo_products.present? %>
    <% @promo.promo_products.each do |product| %>
      <tbody>
          <td><%= ProductsApi.all.find {|obj| obj.id == product.product_id}.product_model %></td>
       
        </tr>
      </tbody>
    <% end %>
  <% end %>
</table>
<% rescue %>
<% end %>
